# Alex

**alex**项目旨在开发一款带运算能力的有限状态机。

- [Alex](#alex)
  - [特性](#%e7%89%b9%e6%80%a7)
  - [语法](#%e8%af%ad%e6%b3%95)
    - [基础状态机](#%e5%9f%ba%e7%a1%80%e7%8a%b6%e6%80%81%e6%9c%ba)
    - [合并文法](#%e5%90%88%e5%b9%b6%e6%96%87%e6%b3%95)
    - [默认指令](#%e9%bb%98%e8%ae%a4%e6%8c%87%e4%bb%a4)
    - [多重输入](#%e5%a4%9a%e9%87%8d%e8%be%93%e5%85%a5)
    - [范围输入](#%e8%8c%83%e5%9b%b4%e8%be%93%e5%85%a5)
    - [合并状态](#%e5%90%88%e5%b9%b6%e7%8a%b6%e6%80%81)
    - [文法规则](#%e6%96%87%e6%b3%95%e8%a7%84%e5%88%99)
  - [指令集](#%e6%8c%87%e4%bb%a4%e9%9b%86)

## 特性

- Alex可以用于加载带运算有限状态机，并在一个输入流上运行这个有限状态机。

- Alex可以跟踪有限状态机的行为，输出有限状态机接收的词法序列，捕捉有限状态机的输出。

## 语法

### 基础状态机

Alex状态机从`1`状态开始运行，描述此状态下的行为即可开始`Alex`程序。

~~~
1 'a' stay
1 'b' accept 1
1 'b' end
~~~

上述文法的第一行表示在`1`状态，若输入`a`字符，则停滞在此状态。

第二行连同第三行表示若在1状态输入`b`字符，则接受当前token并标记为`1`，然后结束有限状态机运行。

上述文法和正则表达式`a*b`的效果相似。

### 合并文法

上述文法中的第二和第三行所表述的指令都在`1`状态输入`b`字符时按照书写顺序依次执行，所以我们可以将相同的部分合并：

~~~
1 'a' stay
1 'b' ( 
    accept 1 
    end
)
~~~

类似的，我们也可以合并同一个状态上的不同输入:

~~~
1 (
    'a' stay
    'b' ( accept 1 end )
)
~~~

### 默认指令

若您希望为无法预想的输入设计指令，请使用`256`或`*`作为输入情况，当其他情况都不匹配时，有限状态机将执行`256`输入下的内容。

~~~
1 (
    'a' stay
    'b' stay
    'c' stay
    'z' stay
    * ( accept 1 end )
)
~~~

### 多重输入

若多种输入的对应指令相同，至少有一部分相同，您可以将多种输入情况合并:

~~~
1 (
    'a', 'b', 'c', 'z' stay
    * ( accept 1 end )
)
~~~

### 范围输入

若多种输入可以联合成为一个范围，则您可以将其描述为一个范围来节省笔墨：

~~~
1 (
    'a' ~ 'c', 'z' stay
    * ( accept 1 end )
)
~~~

### 合并状态

若某些状态对某些输入的部分指令是相同的，您可以将多重状态书写在一个文法上：

~~~
1, 2, 3 (
    'a' ~ 'c', 'z' stay
    * ( accept 1 end )
)
~~~

### 文法规则

请理解，**Alex**的每一行都在为某（些）状态下的某（些）输入情况**添加**指令。**Alex**源代码都不会覆盖之前书写过的指令。

只要设计好书写顺序，您可以编排复杂的重叠文法。

在一个输入上，您可以按照顺序书写多条指令，它们会按照书写顺序被执行，直到此状态上的指令被耗尽或执行了**状态指令**。

## 指令集

`Alex`程序的指令格式类似于汇编程序，由`cmd [arg]...`的格式构成一条指令。

下表描述了`Alex`支持的所有指令，参数列表中的每个字母表示一种数据类型：

 - i: 整数，可以使用数字或单引号包括的字符，字符支持C语言风格转义。
 - s: 字符串，使用双引号包含的文本内容，支持转义。
 - a: 整数或字符串。
 - l: 标记，由英文字母构成的单词，或由数字构成的地址。

|指令名|参数列表|备注|
|---|---|---|
|`end`||结束有限状态机|
|`drop`||放弃当前预览，停滞在当前状态|
|`stay`||输入当前预览，停滞在当前状态|
|`into`|`i`|输入当前预览，进入`%0`状态|
|`goto`|`i`|不处理当前预览，进入`%0`状态|